{% if site.disqus %}
<div class="comments">
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      // Ensure proper URL construction
      var siteUrl = '{{ site.url }}';
      var pageUrl = '{{ page.url }}';
      var fullUrl = siteUrl;
      
      if (siteUrl && pageUrl) {
        // Remove trailing slash from siteUrl if present
        siteUrl = siteUrl.replace(/\/$/, '');
        // Ensure pageUrl starts with /
        if (!pageUrl.startsWith('/')) {
          pageUrl = '/' + pageUrl;
        }
        fullUrl = siteUrl + pageUrl;
      }
      
      this.page.url = fullUrl;
      this.page.identifier = '{{ page.id }}' || pageUrl;
      this.page.title = '{{ page.title }}';
    };
    
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://{{ site.disqus }}.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      s.async = true;
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
{% endif %}
